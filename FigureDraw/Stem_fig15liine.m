power =[10 15 20 25 30 35 40 45];
power2 = linspace(30, 55, 25)';
power4 = linspace(30, 55,25);
power3 = linspace(30, 55, 24)';

%_full_precoder_PCS_BER
% sc_8_full_precoder_PCS_BER3= [000000000000000000 000000000000000000000 000000000000000000000 0.27094498539212575 0.36280752234014235 0.3886502766167097 0.4855094440259403 0.6314378660982074 0.7314378660982074 0.830392511872093 1.138587482252579 1.4305779844768485 1.6126911769461387 1.62226911769461387 1.6450567947708628 1.6989102010319517 1.6831206910913972 1.7093404256877136 1.7026261297391052 1.7091504614365425 1.7097879219533971 1.708411229018807 1.7000885332474405 1.7000885332474405 1.7000885332474405];
% sc_8_full_precoder_PCS_BER4 =[0.001160878297818968 0.0013881823375849756 0.0010868527130840633 0.271361145826317 0.36319868668761 0.13501970083350656 0.23732704868583454 0.3537773838921674 0.22716908932483726 0.531366101267555 0.8448204680938667 0.2462610024449221 0.38394036351419203 1.2913981569370758 1.199615957165125 1.292151441730585 1.4327471634368205 1.6870578746363827 1.4297104553874656 1.7022513889555424 1.687609635913323 1.6342815675888298 1.5498011966506513 1.4789048967045462 0.00046281845911888553];
% sc_8_full_precoder_PCS_BER  =[0.001160878297818968 0.0013881823375849756 0.0010868527130840633 0.270944985392125 0.36241128646198 0.3886502766167097 0.6314378660982074 0.5642250695239857 0.44627207091445653 0.33024168576525614 0.8441804511478628 0.7108378226678642 0.38394036351419203 1.2913981569370758 1.199615957165125 1.292151441730585 1.454138758119154 1.7094596154330466 1.709634122516254 1.6992215164724587 1.709518886195002 1.70782039704225 1.6639379240569325 1.698384316113176 1.698384316113176 ];
% sc_8_Zeroforce_PCS_BER  =    [0.08519829440536864 0.10062894894226426    0.1591279832421839 0.24059591291998617 0.11922930344842975 0.2498599461878186 0.2372547945649739 0.2686048592134669 0.2583189825942229 0.23760364582478877 0.1547687314359445 0.25008414294345904 0.22268973856598162 0.031447368083751925 0.0018580718446745692 0.0006678087323859216 0.0007721059532919128 3.5291365187539725e-05 0 0 0 0 0 0 0];
sc_8_full_precoder_PCS_BER =[0.08519829440536864 0.10062894894226426    0.1591279832421839 0.270944985392125    0.36280752234014235 0.3886502766167097 0.6314378660982074 0.6314378660982074 0.7314378660982074 0.830392511872093 1.138587482252579 1.4305779844768485 1.6126911769461387 1.62226911769461387 1.6450567947708628 1.6989102010319517 1.6831206910913972 1.7093404256877136 1.7026261297391052 1.7091504614365425 1.7097879219533971 1.708411229018807 1.7000885332474405 1.7000885332474405 1.7000885332474405];
ber_8_full_precoder_PCS_BER = [0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425 0.0037995306825008425];
% sc_16_full_precoder_PCS_BER =[ 0 0 0 0 0 0 0 0 0 0 0 0 0.0005515282230286189 0.24140096618485174 0.42395038696375753 0.5708798863654092 0.7972295258140418 1.106239580581752 1.5006177965556136 1.840751537548492 1.825539129093296 1.8096734925426352 1.8323982478529084 1.7941737797745807 1.8366344562407724  ];
sc_16_full_precoder_PCS_BER   =[0.11186098109721643 0.13287324792370558 0.2219742697403424 0.29283832888257777 0.29283832888257777 0.292319775565693  0.3140465280388458 0.2559200726543951 0.3222152207519331 0.3584166573825573 0.5037399685889814 0.2908642604884779 0.43932587910026655 0.33880529790819836 0.47912469148883474 0.4099387835787045 0.5687845452019697 0.7668874457042927 1.0811328934252957 1.490285353912805 1.8353246354588757 1.824116000894671 1.8408874804092195 1.8423768797624085 1.8423768797624085];

ber_16_full_precoder_PCS_BER=[0.0037967426049463912 0.0037915328031305215  0.0037989217576320233  0.003799623457817308 0.003795982536323652 0.0037994501280689866 0.003799807044591788  0.003799807044591788 0.003799807044591788 0.003793757333556025 0.00379428598154997 0.0037994501280689866 0.003799807044591788  0.003799807044591788 0.003799807044591788 0.003793757333556025 0.0037994501280689866 0.003799807044591788  0.003799807044591788 0.003799807044591788 0.003793757333556025 0.0037994501280689866 0.003799807044591788  0.003799807044591788 0.003799807044591788];

%Full precode PCS NOBER
% sc_8_full_precoder_PCS_NOBER  =[1.4285613932371808 1.6363540943283437 1.7612524916559709 1.840875486585813 2.174673325268368 2.2962987356965714 2.351307882545152 2.443071000338168 2.5286745135833884 2.649350410737652 2.770517240041273 2.77469075784158 2.7363094924654057 2.733980024709334 2.734514945643303 2.7765821051440733 2.7775641098014248 2.7742324717111364 2.7768740789549797 2.7387761599532894 2.7773783174500255 2.753465545604079 2.7652287074651754 2.776474225084784 2.7472225587103383];
% ber_8_full_precoder_PCS_NOBER =[0.24623930610683295 0.31651388005208997 0.26733903290688954 0.37513586550309625 0.3683263196114333 0.31575264913928547 0.3132872428068229 0.312662974913684 0.30619029268965975 0.28852329576957053 0.2624980359272008 0.25109706733411735 0.25165058311530253 0.2494033025076411 0.2516069951881148 0.25266805386535934 0.2506689212329088 0.24957248682112895 0.2506216788146185 0.24898621989055634 0.24919550357878487 0.24511194651336046 0.23950496353340847 0.2472632007683803 0.24402447260299087];
% sc_16_full_precoder_PCS_NOBER =[1.255503020829599 1.5592247590946933  1.6201874921152433 1.9157586175486632 2.0628931957862298 2.1905444178192655 2.2185193739351328 2.4005865528099575 2.584499278857657 2.6658647257623374 2.714959272198362 2.9829412064392202 3.223059307427179 3.2853176879359465 3.3256689718072403 3.2219740556674084 3.248575769427622 3.337188907411263 3.354407847965349 3.39317089543951 3.262962279965926 3.262962279965926 3.3259374997224254 3.323059779626669 3.3329855797710826];
% ber_16_full_precoder_PCS_NOBER=[0.5209076567473417  0.5750034239856905 0.620042160765492  0.27736380060997845 0.33328240824298755 0.291730283983098 0.43456537209729373 0.329998379577266 0.29325486405499795 0.3036365844030703 0.27199815002525823 0.2999040483427086 0.3172456265107524 0.21937374505306054 0.23690943886241134 0.20935352765636953 0.21811911343977541 0.21348414143238217 0.23271998604207755 0.23389390112700748 0.21636782802223486 0.2279547015065403 0.22776164342423522 0.21963695434088393 0.22355045262521267];

%Precode UNI BER
%lost first 3
sc_8_uni_BER  =[0 0 0 0 0 0 0 0 0 0  0 0.2129266070888125 0.49776698983501344 0.6686302397242034 1.038587482252579 1.4105779844768485 1.6026911769461387 1.6450567947708628 1.6451189687772434 1.6448602688186318  1.640734057516915  1.6470787847831314 1.6403336660117627 1.6450565126783743 1.6449843873649033 ];%42
% sc_8_uni_BER  =[0 0 0 0 0 0 0 0 0 0 0 3  3 3 3 3  3 3 3 3 3 3 3 3  3 ];
% ber_8_uni_BER =[1 1 1 1 1 1 1 1 1 1 0.003216267575068979 , 0.003451917318406446  0.0015671805634101517  0.0013947115607443712 0.0003197496889945232 0.00040192933816349317 5.4896854606801746e-06 2.987313383843152e-06  0.0004776347360253189 1.0572515617909493e-08 4.934749331399309e-28 , 8.274077792637705e-07 9.468580354784028e-90 3.923865727207651e-33 3.923865727207651e-33];
ber_8_uni_BER =[1 1 1 1 1 1 1 1 1 1 0.003216267575068979 0.0037999175457725707 0.0037999175457725707 0.0037999175457725707  0.0037987715866857424 0.0037987715866857424  0.0037987715866857424 0.0022579731648543918 0.00023282548361632405 7.122955179321993e-06 3.1365076570890996e-08 6.580489343315069e-12 1.0913460823251749e-17 8.620172778333431e-27 3.6658281481748377e-41];
sc_16_uni_BER =[ 0 0 0 0 0 0 0 0 0 0 0  0 0 0 0 0 0.36934072949992913 0.42053031849348965 0.5937819788539871 4 4 4 4 4 4]/2.2;%44

% sc_16_uni_BER =[ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2.8981740454287577 4 4 4 4 4 4 4 4 4];%44
ber_16_uni_BER=[ 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0.00370655158216107 0.00370655158216107  0.0035236325777362595 0.0026417485550086417  0.0011441709243202015 1.0128585472209728e-06 0.00000003943983983315113 0.00000022447137280098045 0.00000025105762061593006 3.003973481776307e-18 1.5216958313268318e-31];

% Precode UNI noBER
% sc_8_uni_NOBER  =[1.2019946953998542  1.4629118603833908 1.738308132690093 2.024793628989782 2.1374105166144086 2.6250556323303473 2.9965748449036953 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3];
% ber_8_uni_NOBER =[1.1459109035933892 1.0049797369460725  0.8579477114864913 0.7829810999078066 0.5777409585271407 0.4551071949675093 0.3546030579591134 0.26820370399718657 0.19703289289918122 0.1395316722331527 0.15977231835032224 0.12579057180479647 0.08905812690749469 0.09033333962096911 0.11514683538836339 0.1296696267295367 0.0820256986527325 0.042937438388496514 0.04132556217203942 0.0857356103340406 0.10240984994350477 0.08565084874504394 0.006026924099305413 0.021565499077223688 0.021565499077223688];
% sc_16_uni_NOBER =[1.2019946953998542  1.4629118603833908 1.738308132690093 2.024793628989782 2.1374105166144086 2.62502565951274 2.9379474292619054 3.4287967391771597 3.8264070476786802 3.9813855244139815 4.00082152210657 3.998342117139828 4.001225732811628 4 4 4 4 4 4 4 4 4 4 4 4 ]; %t? 35
% ber_16_uni_NOBER=[1 1 1 1 1 1 1 1 1 1 1 0.00370655158216107  0.0035236325777362595 0.0010410100708115096  6.30877365235986e-05 0.00012130597764284432 2.0349805658942916e-08 1.8247157233022165e-05 1.529986540000907e-05 1.529986540000907e-05 9.105779871152948e-07 3.030847410001596e-36 0 0 0];

%Zeroforce_PCS_BER
% sc_8_Zeroforce_PCS_BER  =[0.08519829440536864 0.10062894894226426 0.1591279832421839 0.24059591291998617 0.11922930344842975 0.2498599461878186 0.2372547945649739 0.2686048592134669 0.2583189825942229 0.23760364582478877 0.1547687314359445 0.25008414294345904 0.22268973856598162 0.031447368083751925 0.0018580718446745692 0.0006678087323859216 0.0007721059532919128 3.5291365187539725e-05 0 0 0 0 0 0 0]; %chay t? 85
% % ber_8_Zeroforce_PCS_BER =[0.0037999009907509827 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.0023854128671489476 0.00022865117866476255 7.0149826853820825e-06 3.063482898635977e-08 6.2777340856901014e-12 2.5899629898322116e-18 6.531637918385387e-27 3.3261677522852075e-41 6.143540956889121e-64 0 0 0 0 0 0 0 0];
% ber_8_Zeroforce_PCS_BER =[0.0037999009907509827 0.00379751407930487 0.0037999009907509827 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.00379751407930487 0.0023854128671489476 0.00022865117866476255 7.0149826853820825e-06 3.063482898635977e-08 6.2777340856901014e-12 2.5899629898322116e-18 6.531637918385387e-27 3.3261677522852075e-41 6.143540956889121e-64 0 0 0 0 0 0];
% sc_16_Zeroforce_PCS_BER =[0.11186098109721643 0.13287324792370558 0.2219742697403424 0.29283832888257777 0.2076311179353576 0.22700123278871231  0.3140465280388458  0.2559200726543951 0.2973888844873023 0.3584166573825573 0.4018099213615254 0.2908642604884779 0.27147648692003923 0.3290203373255256 0.20368790855447383 0.2660274497505659 0.3449360270855166 0.06490854933122492 0.0047201809932797545 0.0028604535709710888 0.0009433819259250242 0.0013448613081292748 8.158735024376488e-28 0 0 ];
% ber_16_Zeroforce_PCS_BER=[0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0037985593284160985 0.0031981241409816015 0.00042682933331785074 1.987067823171952e-05 1.4074616601086836e-07 6.544664706347253e-11 7.387140996198049e-16 0 0 0 0 0 0 0 0 0 ];



% 
% sc_8_uni  =[0 0 0 0 3.0000000000000018];
% ber_8_uni =[0.0037999009907509827 0.0037999175457725707 0.0037999175457725707 0.0037999175457725707  0.0037987715866857424 0.0037987715866857424  0.0037987715866857424 0.0022579731648543918 0.00023282548361632405 7.122955179321993e-06 3.1365076570890996e-08 6.580489343315069e-12 1.0913460823251749e-17 8.620172778333431e-27 3.6658281481748377e-41 6.994936466098275e-64 7.806821087539599e-100 9.404251911798436e-157 6.599752153213219e-247 0.0];
% sc_16_uni =[0 0 0 0 0 0 0 0 0 0 4 4 4 4 4 4 4 4 4 4];
% 
% ber_16_uni=[0 0 0 0 0 0 0 0 0 0 0 0.00370655158216107  0.0035236325777362595 0.0010410100708115096  6.30877365235986e-05 0.00012130597764284432 2.0349805658942916e-08 1.8247157233022165e-05 1.529986540000907e-05 1.529986540000907e-05 9.105779871152948e-07 3.030847410001596e-36];
f = fit(power2,sc_8_full_precoder_PCS_BER','smoothingspline','SmoothingParam',0.182242591);
coeffs = coeffvalues(f);
sc_8_full_precoder_PCS_BER2 = coeffs.coefs(:,4);

% f = fit(power2,ber_8_full_precoder_PCS_BER2','smoothingspline','SmoothingParam',0.182242591);
% coeffs = coeffvalues(f);
% ber_8_full_precoder_PCS_BER2= coeffs.coefs(:,4);

f = fit(power2,sc_16_full_precoder_PCS_BER','smoothingspline','SmoothingParam',0.182242591);
coeffs = coeffvalues(f);
sc_16_full_precoder_PCS_BER2= coeffs.coefs(:,4);

f = fit(power2,ber_16_full_precoder_PCS_BER','smoothingspline','SmoothingParam',0.182242591);
coeffs = coeffvalues(f);
ber_16_full_precoder_PCS_BER2= coeffs.coefs(:,4);

figure1 = figure;
% Change default axes fonts.
set(0,'DefaultAxesFontName', 'Times New Roman')
set(0,'DefaultAxesFontSize', 14)

subplot1 = subplot(1,4,1,'Parent',figure1);
hold(subplot1,'on');
plot(power3,sc_8_full_precoder_PCS_BER2,'r-x');
% plot(power4,sc_8_full_precoder_PCS_NOBER,'b--o');
plot(power4,sc_8_uni_BER,'k--*');
% plot(power4,sc_8_uni_NOBER,'y--o');
title('\rm a, 8PAM ')
% plot(power4,sc_8_Zeroforce_PCS_BER,'k--o');
% legend('Full precode PCS BER','Full precode PCS NOBER','uni BER','uni NOBER','Zeroforce PCS_BER');
legend(' Joint Precoding and PCS Design','Precoding-only design','Orientation', 'Horizontal');
hold on
grid on
xlim([30 55])
ylim([0 2])
grid on
xlabel('\it P_t \rm(dBm)');
ylabel('SC (bits/s/Hz)');



% figure;
subplot2 = subplot(1,4,2,'Parent',figure1);
hold(subplot2,'on');
semilogy(power4,ber_8_full_precoder_PCS_BER,'r-x');
% semilogy(power4,ber_8_full_precoder_PCS_NOBER,'b--o');
semilogy(power4,ber_8_uni_BER,'k--*');
% semilogy(power4,ber_8_uni_NOBER,'y--o');
% semilogy(power4,ber_8_Zeroforce_PCS_BER,'k--o');
set(gca, 'YScale', 'log');
% legend('Full precode PCS BER','Full precode PCS NOBER','uniBER','uniNOBER','ZeroforcePCS_BER');
ylim([10^-6 1])
hold on
grid on
xlim([30 55])

xlabel('\it P_t \rm(dBm)');
ylabel('BER');

subplot3 = subplot(1,4,3,'Parent',figure1);
hold(subplot3,'on');
plot(power4,sc_16_full_precoder_PCS_BER,'r-x');
% plot(power4,sc_16_full_precoder_PCS_NOBER,'b--o');
plot(power4,sc_16_uni_BER,'k--*');
% plot(power4,sc_16_uni_NOBER,'y--o');
% plot(power4,sc_16_Zeroforce_PCS_BER,'k--o');
title('\rm b, 16PAM ')
% legend('Full precode PCS BER','Full precode PCS NOBER','uniBER','uniNOBER','ZeroforcePCSBER');
hold on
grid on
xlim([30 55])
ylim([0 2])
xlabel('\it P_t \rm(dBm)');
ylabel('SC (bits/s/Hz)');


subplot4 = subplot(1,4,4,'Parent',figure1);
hold(subplot4,'on');
semilogy(power4,ber_16_full_precoder_PCS_BER,'r-x');
% semilogy(power4,ber_16,'b--o');
% semilogy(power4,ber_16_full_precoder_PCS_NOBER,'b--o');
semilogy(power4,ber_16_uni_BER,'k--*');
% semilogy(power4,ber_16_uni_NOBER,'y--o');
% semilogy(power4,ber_16_Zeroforce_PCS_BER,'k--o');
set(gca, 'YScale', 'log');
% legend('Full precode PCS BER','Full precode PCS NOBER','uniBER','uniNOBER','ZeroforcePCS_BER');
hold on
grid on
xlim([30 55])
ylim([10^-6 1])
xlabel('\it P_t \rm(dBm)');
ylabel('BER');